# 游戏规则

## 基本规则

- 蛇头碰到墙壁或没有处于无敌状态的蛇身，游戏结束。
- 蛇头碰到食物，蛇身增加一节（此回合蛇尾不会移动）。
- 玩家出生时会有若干回合的无敌时间。
- 每回合为 `250ms`，你必须选择一个方向移动，不能原地掉头。
- 无敌状态下，玩家可以穿过自己的身体和其他玩家的身体而不会死亡。
- 地图大小为 `100*100`，食物会维持在一定密度。

## 坐标系统

- 坐标使用 0-index。
- 地图左上角是 `(0, 0)`。
- 合法横坐标范围：`0 <= x < map_width`。
- 合法纵坐标范围：`0 <= y < map_height`。
- 右下角是 `(map_width - 1, map_height - 1)`。

## 越界判定

- 只要下一步头坐标不在合法范围内，就算撞墙。
- 例如 `x = -1`、`x = map_width`、`y = -1`、`y = map_height` 都是越界。

## 回合时序工作流

服务器每回合大致按这个顺序执行：

1. 读取你上回合提交的方向。
2. 所有蛇同时移动一步。
3. 再做碰撞结算。
4. 再处理吃食物。
5. 回合末尾减少 `invincible_rounds`。

### 关键说明

- 你在本回合返回的方向，不是"立刻"生效，而是用于下一次移动。
- 回合号从 `0` 开始增长。

## 移动约束

- **反向移动不会生效**：例如当前向 `right` 走，本回合提交 `left` 会被忽略。
- 被忽略的命令会导致蛇继续沿当前方向前进（不是停住）。

## 碰撞结算细节

- 采用"同时移动后统一结算"，不是按玩家顺序逐个结算。
- 多条蛇同回合进入同一格（包括撞头）会在结算时死亡（若非无敌）。
- 自撞是按"移动前身体"预判，因此不会因为"尾巴刚好挪走"而误判成安全。

## 无敌状态

- `invincible_rounds > 0` 时，碰撞不会导致死亡。
- 无敌蛇在服务端碰撞结算里不作为可致死障碍。
- 无敌回合数在"回合末尾"减少，所以"无敌 1 回合"在整个该回合都有效。

## 食物与长度增长

- 吃到食物发生在"移动之后"的阶段。
- 当回合吃到食物会记录一次增长，长度通常在后续移动时体现为"这一步不掉尾巴"。
- 因此你会看到长度增长有半拍延迟，这是正常设计。